{{ 'section-collection-list.min.css' | asset_url | stylesheet_tag }}

{% case section.settings.colors %}
  {% when 'white' %}
    <section class="homepage-sections-wrapper homepage-sections-wrapper--white">
  {% when 'light' %}
    <section class="homepage-sections-wrapper homepage-sections-wrapper--light">
  {% when 'accent' %}
    <section class="homepage-sections-wrapper homepage-sections-wrapper--accent">
  {% when 'dark' %}
    <section class="homepage-sections-wrapper homepage-sections-wrapper--dark">
{% endcase %}

  <div class="container">
    <div class="row">
      <div class="page-width col-md-12">

        {% if section.settings.title != blank or section.settings.subheading != blank %}
          <div class="title-bar custom-font">
            {% if section.settings.subheading != blank %}
              <h3 class="type-subheading type-subheading--1 wow fadeIn{% if section.settings.subheading != blank %} typography--padding-bottom{% endif %}">{{ section.settings.subheading | escape }}</h3>
            {% endif %}
            {% if section.settings.title != blank %}
              <h2 class="wow fadeIn{% if section.settings.title != blank %} delay-1{% endif %}">{{ section.settings.title | escape }}</h2>
            {% endif %}
          </div>
        {% endif %}

        <div class="collection-grid">
          <div class="row"></div>
        </div>

      </div>
    </div>
  </div>
</section>

<script>

  async function getCollection() {
    const query = `query {
    collections(query:"custom.collection_type:brand", first: 250) {
      edges {
        node {
          id
          title
          handle
          image {
            url
          }
          metafield(namespace:"custom", key:"collection_type") {
            value
          }
        }
      }
    }
  }`;

    try {
      const resp = await fetch(`https://maisonflaneur.myshopify.com/api/2022-07/graphql.json`, {
        method: "POST",
        headers: {
          "Content-Type": "application/graphql",
          "X-Shopify-Storefront-Access-Token": '9c0d83d3ac9df7037c7057a7ed376f62'
        },
        body: query
      });

      const data = await resp.json();
      return data;
    } catch (error) {
      throw new Error(`HTTP error! status: ${resp.status}`);
    }
  }

  (async () => {
    const datas = await getCollection();
    const collections = datas.data.collections.edges;

    // Filter and shuffle the collection nodes
    const selectedCollections = collections
      .filter(({ node }) => node.metafield !== null && node.metafield.value === "{{ section.settings.collection_type }}")
      .sort(() => 0.5 - Math.random())
      .slice(0, 3);

    for (const { node: selectedCollectionNode } of selectedCollections) {
      const indivCollectionGridHomepage = document.createElement('article');
      indivCollectionGridHomepage.className = 'indiv-collection-grid-homepage wow fadeInUp col-md-4';

      const collectionGridInner = document.createElement('div');
      collectionGridInner.className = 'homepage-collection-grid-inner';

      const gridImage = document.createElement('div');
      gridImage.className = 'grid-image';

      const gridImageCentered = document.createElement('div');
      gridImageCentered.className = 'grid-image--centered';

      const imageSrc = selectedCollectionNode.image.url;
      const img = document.createElement('img');
      img.src = imageSrc;

      gridImageCentered.appendChild(img);

      gridImage.appendChild(gridImageCentered);
      collectionGridInner.appendChild(gridImage);

      indivCollectionGridHomepage.appendChild(collectionGridInner);

      const hpTitle = document.createElement('div');
      hpTitle.className = 'hp-title homepage-collection-link';

      const h3 = document.createElement('h3');
      h3.className = 'type-subheading type-subheading--1';

      const link = document.createElement('a');
      link.href = selectedCollectionNode.handle;
      link.textContent = selectedCollectionNode.title;

      h3.appendChild(link);
      hpTitle.appendChild(h3);
      indivCollectionGridHomepage.appendChild(hpTitle);

      document.querySelector('.collection-grid .row').appendChild(indivCollectionGridHomepage);
    }
  })();


</script>

{% schema %}
{
    "name": {
        "en": "Maison - Collection list",
        "de": "Kollektionsliste",
        "es": "Lista de colecciones",
        "fr": "Liste des collections",
        "pt-PT": "Lista da coleção"
    },
    "class": "homepage-section--featured-collections-wrapper wow fadeIn",
    "settings": [
        {
            "type": "select",
            "id": "colors",
            "label": {
                "en": "Color scheme",
                "de": "Farbschema",
                "es": "Esquema de colores",
                "fr": "Palette de couleurs",
                "pt-PT": "Esquema de cores"
            },
            "default": "white",
            "options": [
                {
                    "value": "white",
                    "label": {
                        "en": "White",
                        "de": "Weiß",
                        "es": "Blanco",
                        "fr": "Blanc",
                        "pt-PT": "Branco"
                    }
                },
                {
                    "value": "light",
                    "label": {
                        "en": "Light",
                        "de": "Licht",
                        "es": "Luz",
                        "fr": "Clair",
                        "pt-PT": "Claro"
                    }
                },
                {
                    "value": "accent",
                    "label": {
                        "en": "Feature",
                        "de": "Eigenschaft",
                        "es": "Destacado",
                        "fr": "Caractéristique",
                        "pt-PT": "Funcionalidade"
                    }
                },
                {
                    "value": "dark",
                    "label": {
                        "en": "Dark",
                        "de": "Dunkel",
                        "es": "Oscuro",
                        "fr": "Foncé",
                        "pt-PT": "Escuro"
                    }
                }
            ],
            "info": {
                "en": "Set your color schemes in 'Theme settings' > 'Colors'",
                "de": "Legen Sie Ihre Farbschemata in 'Themeneinstellungen' > 'Farben' fest",
                "es": "Configurar las combinaciones de color en 'Configuración del tema' > 'Colores'",
                "fr": "Définissez vos jeux de couleurs dans « Paramètres du thème » > « Couleurs »",
                "pt-PT": "Defina os seus esquemas de cor em 'Definições de tema' > 'Cores'"
            }
        },
        {
          "type": "text",
          "id": "subheading",
          "label": {
            "en": "Subheading",
            "de": "Unterüberschrift",
            "es": "Subencabezado",
            "fr": "Sous-rubrique",
            "pt-PT": "Subtítulo"
          }
        },
        {
          "type": "text",
          "id": "title",
          "label": {
            "en": "Heading",
            "de": "Überschrift",
            "es": "Encabezado",
            "fr": "Rubrique",
            "pt-PT": "Título"
          }
        },
      {
        "type": "select",
        "id": "collection_type",
        "label": "Collection type",
        "default": "brand",
        "options": [
          {
            "value": "brand",
            "label": "Brand"
          },
          {
            "value": "hotel",
            "label": "Hotel"
          }
        ]
      }
    ],
    "presets": [
        {
            "name": {
                "en": "Maison - Collection list",
                "de": "Kollektionsliste",
                "es": "Lista de colecciones",
                "fr": "Liste des collections",
                "pt-PT": "Lista da coleção"
            },
            "category": {
                "en": "Collection",
                "de": "Kollektion",
                "es": "Colección",
                "fr": "Collection",
                "pt-PT": "Coleção"
            }
        }
    ]
}
{% endschema %}
